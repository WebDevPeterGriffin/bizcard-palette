module.exports=[88367,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(97895);let f=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:d,className:(0,e.cn)("w-full caption-bottom text-sm",a),...c})}));f.displayName="Table";let g=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("thead",{ref:d,className:(0,e.cn)("[&_tr]:border-b",a),...c}));g.displayName="TableHeader";let h=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tbody",{ref:d,className:(0,e.cn)("[&_tr:last-child]:border-0",a),...c}));h.displayName="TableBody",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tfoot",{ref:d,className:(0,e.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let i=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tr",{ref:d,className:(0,e.cn)("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50",a),...c}));i.displayName="TableRow";let j=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("th",{ref:d,className:(0,e.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));j.displayName="TableHead";let k=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("td",{ref:d,className:(0,e.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...c}));k.displayName="TableCell",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("caption",{ref:d,className:(0,e.cn)("mt-4 text-sm text-muted-foreground",a),...c})).displayName="TableCaption";var l=a.i(40695),m=a.i(70121),n=a.i(50104),o=a.i(7554),p=a.i(25152),q=a.i(77994),r=a.i(3688),s=a.i(77192),t=a.i(30553),u="Checkbox",[v,w]=(0,n.createContextScope)(u),[x,y]=v(u);function z(a){let{__scopeCheckbox:d,checked:e,children:f,defaultChecked:g,disabled:h,form:i,name:j,onCheckedChange:k,required:l,value:m="on",internal_do_not_use_render:n}=a,[o,q]=(0,p.useControllableState)({prop:e,defaultProp:g??!1,onChange:k,caller:u}),[r,s]=c.useState(null),[t,v]=c.useState(null),w=c.useRef(!1),y=!r||!!i||!!r.closest("form"),z={checked:o,disabled:h,setChecked:q,control:r,setControl:s,name:j,form:i,value:m,hasConsumerStoppedPropagationRef:w,required:l,defaultChecked:!H(g)&&g,isFormControl:y,bubbleInput:t,setBubbleInput:v};return(0,b.jsx)(x,{scope:d,...z,children:"function"==typeof n?n(z):f})}var A="CheckboxTrigger",B=c.forwardRef(({__scopeCheckbox:a,onKeyDown:d,onClick:e,...f},g)=>{let{control:h,value:i,disabled:j,checked:k,required:l,setControl:n,setChecked:p,hasConsumerStoppedPropagationRef:q,isFormControl:r,bubbleInput:s}=y(A,a),u=(0,m.useComposedRefs)(g,n),v=c.useRef(k);return c.useEffect(()=>{let a=h?.form;if(a){let b=()=>p(v.current);return a.addEventListener("reset",b),()=>a.removeEventListener("reset",b)}},[h,p]),(0,b.jsx)(t.Primitive.button,{type:"button",role:"checkbox","aria-checked":H(k)?"mixed":k,"aria-required":l,"data-state":I(k),"data-disabled":j?"":void 0,disabled:j,value:i,...f,ref:u,onKeyDown:(0,o.composeEventHandlers)(d,a=>{"Enter"===a.key&&a.preventDefault()}),onClick:(0,o.composeEventHandlers)(e,a=>{p(a=>!!H(a)||!a),s&&r&&(q.current=a.isPropagationStopped(),q.current||a.stopPropagation())})})});B.displayName=A;var C=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,name:e,checked:f,defaultChecked:g,required:h,disabled:i,value:j,onCheckedChange:k,form:l,...m}=a;return(0,b.jsx)(z,{__scopeCheckbox:d,checked:f,defaultChecked:g,disabled:i,required:h,onCheckedChange:k,name:e,form:l,value:j,internal_do_not_use_render:({isFormControl:a})=>(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B,{...m,ref:c,__scopeCheckbox:d}),a&&(0,b.jsx)(G,{__scopeCheckbox:d})]})})});C.displayName=u;var D="CheckboxIndicator",E=c.forwardRef((a,c)=>{let{__scopeCheckbox:d,forceMount:e,...f}=a,g=y(D,d);return(0,b.jsx)(s.Presence,{present:e||H(g.checked)||!0===g.checked,children:(0,b.jsx)(t.Primitive.span,{"data-state":I(g.checked),"data-disabled":g.disabled?"":void 0,...f,ref:c,style:{pointerEvents:"none",...a.style}})})});E.displayName=D;var F="CheckboxBubbleInput",G=c.forwardRef(({__scopeCheckbox:a,...d},e)=>{let{control:f,hasConsumerStoppedPropagationRef:g,checked:h,defaultChecked:i,required:j,disabled:k,name:l,value:n,form:o,bubbleInput:p,setBubbleInput:s}=y(F,a),u=(0,m.useComposedRefs)(e,s),v=(0,q.usePrevious)(h),w=(0,r.useSize)(f);c.useEffect(()=>{if(!p)return;let a=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set,b=!g.current;if(v!==h&&a){let c=new Event("click",{bubbles:b});p.indeterminate=H(h),a.call(p,!H(h)&&h),p.dispatchEvent(c)}},[p,v,h,g]);let x=c.useRef(!H(h)&&h);return(0,b.jsx)(t.Primitive.input,{type:"checkbox","aria-hidden":!0,defaultChecked:i??x.current,required:j,disabled:k,name:l,value:n,form:o,...d,tabIndex:-1,ref:u,style:{...d.style,...w,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});function H(a){return"indeterminate"===a}function I(a){return H(a)?"indeterminate":a?"checked":"unchecked"}G.displayName=F;var J=a.i(33441);let K=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(C,{ref:d,className:(0,e.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),...c,children:(0,b.jsx)(E,{className:(0,e.cn)("flex items-center justify-center text-current"),children:(0,b.jsx)(J.Check,{className:"h-4 w-4"})})}));K.displayName=C.displayName;var L=a.i(72228),M=a.i(70106);let N=(0,M.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);var O=a.i(33508);let P=(0,M.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var Q=a.i(92258),R=a.i(63519),S=a.i(69240),T=a.i(42447),U=a.i(77687),V=a.i(5522),W=a.i(17171);let X=({onLogin:a,loading:e})=>{let[f,g]=(0,c.useState)(""),[h,i]=(0,c.useState)(""),j=async b=>{b.preventDefault(),await a(f,h)};return(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:(0,b.jsxs)(d.Card,{className:"w-full max-w-md",children:[(0,b.jsxs)(d.CardHeader,{className:"text-center",children:[(0,b.jsx)(d.CardTitle,{children:"Admin Access"}),(0,b.jsx)(d.CardDescription,{children:"Sign in with your admin credentials"})]}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(W.Label,{htmlFor:"email",children:"Email"}),(0,b.jsx)(V.Input,{id:"email",type:"email",value:f,onChange:a=>g(a.target.value),placeholder:"admin@example.com",required:!0})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(W.Label,{htmlFor:"password",children:"Password"}),(0,b.jsx)(V.Input,{id:"password",type:"password",value:h,onChange:a=>i(a.target.value),placeholder:"Enter admin password",required:!0})]}),(0,b.jsx)(l.Button,{type:"submit",className:"w-full",disabled:e,children:e?"Signing in...":"Sign In"})]})})]})})},Y=({onProcessScheduled:a,onLogout:c,loading:d})=>(0,b.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Admin Dashboard"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage users and view statistics"})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(l.Button,{variant:"outline",onClick:a,disabled:d,children:"Process Scheduled Deletions"}),(0,b.jsx)(l.Button,{variant:"outline",onClick:c,children:"Logout"})]})]});var Z=a.i(87682);let $=({selectedCount:a,bulkAction:c,scheduledDate:d,actionLoading:e,onBulkActionChange:f,onScheduledDateChange:g,onExecute:h,onClear:i})=>0===a?null:(0,b.jsx)("div",{className:"mb-4 p-4 bg-muted rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(W.Label,{children:"Bulk Action:"}),(0,b.jsxs)(Z.Select,{value:c,onValueChange:f,children:[(0,b.jsx)(Z.SelectTrigger,{className:"w-40",children:(0,b.jsx)(Z.SelectValue,{placeholder:"Select action"})}),(0,b.jsxs)(Z.SelectContent,{children:[(0,b.jsx)(Z.SelectItem,{value:"delete",children:"Delete Now"}),(0,b.jsx)(Z.SelectItem,{value:"schedule",children:"Schedule Deletion"})]})]})]}),"schedule"===c&&(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(W.Label,{children:"Date:"}),(0,b.jsx)(V.Input,{type:"datetime-local",value:d,onChange:a=>g(a.target.value),min:new Date().toISOString().slice(0,16),className:"w-48"})]}),(0,b.jsx)(l.Button,{onClick:h,disabled:!c||"bulk"===e||"schedule"===c&&!d,variant:"delete"===c?"destructive":"default",children:"bulk"===e?"Processing...":`${"delete"===c?"Delete":"Schedule"} ${a} users`}),(0,b.jsx)(l.Button,{variant:"outline",onClick:i,children:"Clear Selection"})]})});a.s(["default",0,()=>{let{isAuthenticated:a,isAdmin:e,authLoading:m,handleLogin:n,handleLogout:o}=(()=>{let[a,b]=(0,c.useState)(!1),[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(!0),h=(0,S.createClient)();return(0,c.useEffect)(()=>{(async()=>{try{let{data:{session:a}}=await h.auth.getSession();if(a?.user){b(!0);let{data:c,error:d}=await h.from("user_roles").select("role").eq("user_id",a.user.id).eq("role","admin").maybeSingle();!d&&c?e(!0):(0,U.toast)({variant:"destructive",title:"Access Denied",description:"You don't have admin privileges"})}}catch(a){T.logger.error("Auth check error:",a)}finally{g(!1)}})();let{data:{subscription:a}}=h.auth.onAuthStateChange(async(a,c)=>{"SIGNED_IN"===a&&c?.user?(b(!0),setTimeout(async()=>{let{data:a,error:b}=await h.from("user_roles").select("role").eq("user_id",c.user.id).eq("role","admin").maybeSingle();!b&&a&&e(!0)},0)):"SIGNED_OUT"===a&&(b(!1),e(!1))});return()=>a.unsubscribe()},[]),{isAuthenticated:a,isAdmin:d,authLoading:f,handleLogin:async(a,b)=>{try{let{error:c}=await h.auth.signInWithPassword({email:a,password:b});if(c)throw c;(0,U.toast)({title:"Signed in successfully",description:"Checking admin privileges..."})}catch(b){let a=b instanceof Error?b.message:"Login failed";(0,U.toast)({variant:"destructive",title:"Login failed",description:a})}},handleLogout:async()=>{try{let{error:a}=await h.auth.signOut();if(a)throw a;b(!1),e(!1),(0,U.toast)({title:"Signed out",description:"You have been logged out successfully"})}catch(b){let a=b instanceof Error?b.message:"Logout failed";(0,U.toast)({variant:"destructive",title:"Logout failed",description:a})}}}})(),{users:p,loading:q,actionLoading:r,fetchUsers:s,handleDeleteUser:t,handleCancelSchedule:u,handleProcessScheduled:v}=(()=>{let[a,b]=(0,c.useState)([]),[d,e]=(0,c.useState)(!1),[f,g]=(0,c.useState)(null),h=(0,S.createClient)(),i=async()=>{e(!0);try{let{data:a,error:c}=await h.from("cards").select("*").order("created_at",{ascending:!1});if(c)return void(0,U.toast)({variant:"destructive",title:"Error",description:"Failed to fetch users"});b(a||[])}catch(a){T.logger.error("Error fetching users:",a),(0,U.toast)({variant:"destructive",title:"Error",description:"Failed to fetch users"})}finally{e(!1)}},j=async a=>{g(a);try{let{error:b}=await h.functions.invoke("delete-user",{body:{userId:a,action:"delete_now"}});if(b)throw b;(0,U.toast)({title:"User deleted",description:"User and all associated data have been deleted"}),i()}catch(b){let a=b instanceof Error?b.message:"Failed to delete user";(0,U.toast)({variant:"destructive",title:"Error",description:a})}finally{g(null)}},k=async(a,b)=>{g(a);try{let{error:c}=await h.functions.invoke("delete-user",{body:{userId:a,action:"schedule_deletion",scheduledDate:new Date(b).toISOString()}});if(c)throw c;(0,U.toast)({title:"Deletion scheduled",description:`User will be deleted on ${new Date(b).toLocaleDateString()}`}),i()}catch(b){let a=b instanceof Error?b.message:"Failed to schedule deletion";(0,U.toast)({variant:"destructive",title:"Error",description:a})}finally{g(null)}},l=async a=>{g(a);try{let{error:b}=await h.functions.invoke("delete-user",{body:{userId:a,action:"cancel_schedule"}});if(b)throw b;(0,U.toast)({title:"Schedule cancelled",description:"User deletion schedule has been cancelled"}),i()}catch(b){let a=b instanceof Error?b.message:"Failed to cancel schedule";(0,U.toast)({variant:"destructive",title:"Error",description:a})}finally{g(null)}},m=async()=>{e(!0);try{let{data:a,error:b}=await h.functions.invoke("delete-user",{body:{action:"process_scheduled"}});if(b)throw b;let c=a?.deletedUsers?.length>0?`Processed ${a.deletedUsers.length} scheduled deletions`:"No scheduled deletions to process";(0,U.toast)({title:"Processing complete",description:c}),i()}catch(b){let a=b instanceof Error?b.message:"Failed to process scheduled deletions";(0,U.toast)({variant:"destructive",title:"Error",description:a})}finally{e(!1)}};return{users:a,loading:d,actionLoading:f,fetchUsers:i,handleDeleteUser:j,handleScheduleDeletion:k,handleCancelSchedule:l,handleProcessScheduled:m}})(),{selectedUsers:w,bulkAction:x,scheduledDate:y,actionLoading:z,setBulkAction:A,setScheduledDate:B,handleSelectUser:C,handleSelectAll:D,handleBulkAction:E,clearSelection:F}=(a=>{let[b,d]=(0,c.useState)(new Set),[e,f]=(0,c.useState)(""),[g,h]=(0,c.useState)(""),[i,j]=(0,c.useState)(null),k=(0,S.createClient)(),l=async()=>{if(e&&0!==b.size){j("bulk");try{let c=Array.from(b).map(a=>{if("delete"===e)return k.functions.invoke("delete-user",{body:{userId:a,action:"delete_now"}});if("schedule"===e){if(!g)throw Error("Please select a date");return k.functions.invoke("delete-user",{body:{userId:a,action:"schedule_deletion",scheduledDate:new Date(g).toISOString()}})}return Promise.resolve()}),i=await Promise.allSettled(c),j=i.filter(a=>"rejected"===a.status).length,l=i.filter(a=>"fulfilled"===a.status).length;"delete"===e?(0,U.toast)({title:"Bulk deletion complete",description:`${l} users deleted${j>0?`, ${j} failed`:""}`}):"schedule"===e&&(0,U.toast)({title:"Bulk scheduling complete",description:`${l} users scheduled${j>0?`, ${j} failed`:""}`}),d(new Set),f(""),h(""),a()}catch(b){let a=b instanceof Error?b.message:"Bulk action failed";(0,U.toast)({variant:"destructive",title:"Bulk action failed",description:a})}finally{j(null)}}};return{selectedUsers:b,bulkAction:e,scheduledDate:g,actionLoading:i,setBulkAction:f,setScheduledDate:h,handleSelectUser:a=>{let c=new Set(b);c.has(a)?c.delete(a):c.add(a),d(c)},handleSelectAll:a=>{b.size===a.length?d(new Set):d(new Set(a))},handleBulkAction:l,clearSelection:()=>{d(new Set),f(""),h("")}}})(s);return((0,c.useEffect)(()=>{e&&s()},[e]),m)?(0,b.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):a&&e?(0,b.jsx)("div",{className:"min-h-screen bg-background",children:(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4",children:[(0,b.jsx)(Y,{onProcessScheduled:v,onLogout:o,loading:q}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"User Statistics"}),(0,b.jsxs)(d.CardDescription,{children:["Total users: ",p.length,w.size>0&&(0,b.jsxs)("span",{className:"ml-4 text-primary",children:["(",w.size," selected)"]})]})]}),(0,b.jsxs)(d.CardContent,{children:[(0,b.jsx)($,{selectedCount:w.size,bulkAction:x,scheduledDate:y,actionLoading:z,onBulkActionChange:A,onScheduledDateChange:B,onExecute:E,onClear:F}),q?(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):(0,b.jsxs)("div",{className:"overflow-x-auto",children:[(0,b.jsxs)(f,{children:[(0,b.jsx)(g,{children:(0,b.jsxs)(i,{children:[(0,b.jsx)(j,{className:"w-12",children:(0,b.jsx)(K,{checked:w.size===p.length&&p.length>0,onCheckedChange:()=>D(p.map(a=>a.id))})}),(0,b.jsx)(j,{children:"Name"}),(0,b.jsx)(j,{children:"Email"}),(0,b.jsx)(j,{children:"Phone"}),(0,b.jsx)(j,{children:"Company"}),(0,b.jsx)(j,{children:"Role"}),(0,b.jsx)(j,{children:"Style"}),(0,b.jsx)(j,{children:"Joined"}),(0,b.jsx)(j,{children:"Status"}),(0,b.jsx)(j,{children:"Slug"}),(0,b.jsx)(j,{children:"Actions"})]})}),(0,b.jsx)(h,{children:p.map(a=>(0,b.jsxs)(i,{children:[(0,b.jsx)(k,{children:(0,b.jsx)(K,{checked:w.has(a.id),onCheckedChange:()=>C(a.id)})}),(0,b.jsx)(k,{className:"font-medium",children:a.full_name}),(0,b.jsx)(k,{children:a.email?(0,b.jsxs)("a",{href:`mailto:${a.email}`,className:"text-primary hover:underline flex items-center gap-1",children:[(0,b.jsx)(Q.Mail,{className:"h-3 w-3"}),a.email]}):"N/A"}),(0,b.jsx)(k,{children:a.phone?(0,b.jsxs)("a",{href:`tel:${a.phone}`,className:"text-primary hover:underline flex items-center gap-1",children:[(0,b.jsx)(R.Phone,{className:"h-3 w-3"}),a.phone]}):"N/A"}),(0,b.jsx)(k,{children:a.company||"N/A"}),(0,b.jsx)(k,{children:a.role||"N/A"}),(0,b.jsx)(k,{className:"capitalize",children:a.style_id}),(0,b.jsx)(k,{children:(0,L.format)(new Date(a.created_at),"MMM dd, yyyy")}),(0,b.jsx)(k,{children:a.scheduled_deletion_at?(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-destructive text-sm",children:"Scheduled for deletion"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:(0,L.format)(new Date(a.scheduled_deletion_at),"MMM dd, yyyy")})]}):(0,b.jsx)("span",{className:"text-green-600 text-sm",children:"Active"})}),(0,b.jsx)(k,{children:(0,b.jsxs)("a",{href:`/${a.slug}`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-primary hover:underline",children:[(0,b.jsx)("code",{className:"text-sm bg-muted px-2 py-1 rounded",children:a.slug}),(0,b.jsx)(P,{className:"h-3 w-3"})]})}),(0,b.jsx)(k,{children:(0,b.jsx)("div",{className:"flex items-center gap-2",children:a.scheduled_deletion_at?(0,b.jsxs)(l.Button,{variant:"outline",size:"sm",onClick:()=>u(a.id),disabled:r===a.id,children:[(0,b.jsx)(O.X,{className:"h-4 w-4 mr-1"}),"Cancel"]}):(0,b.jsxs)(l.Button,{variant:"destructive",size:"sm",onClick:()=>t(a.id),disabled:r===a.id,children:[(0,b.jsx)(N,{className:"h-4 w-4 mr-1"}),"Delete"]})})})]},a.id))})]}),0===p.length&&(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No users found"})]})]})]})]})}):(0,b.jsx)(X,{onLogin:n,loading:q})}],88367)}];

//# sourceMappingURL=app_admin_page_tsx_bc658df7._.js.map